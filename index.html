<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saints Calendar Dashboard ⚜️</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #101820 0%, #2c2416 50%, #D3BC8D 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: #ffffff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 30px rgba(211, 188, 141, 0.3);
        }

        .header {
            background: linear-gradient(135deg, #101820 0%, #2c2416 50%, #D3BC8D 100%);
            color: #D3BC8D;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #D3BC8D 0%, #f4e4a6 50%, #D3BC8D 100%);
        }

        .header h1 {
            font-size: 2rem;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .saints-logo {
            font-size: 2.5rem;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5));
        }

        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .user-info {
            background: rgba(211, 188, 141, 0.2);
            color: #D3BC8D;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            border: 1px solid rgba(211, 188, 141, 0.3);
        }

        .btn {
            background: linear-gradient(135deg, #D3BC8D 0%, #f4e4a6 100%);
            color: #101820;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            box-shadow: 0 3px 10px rgba(211, 188, 141, 0.3);
        }

        .btn:hover {
            background: linear-gradient(135deg, #f4e4a6 0%, #D3BC8D 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(211, 188, 141, 0.4);
        }

        .btn.secondary { 
            background: linear-gradient(135deg, #101820 0%, #2c2416 100%);
            color: #D3BC8D;
        }
        .btn.danger { 
            background: linear-gradient(135deg, #8B0000 0%, #DC143C 100%);
            color: white;
        }
        .btn.warning { 
            background: linear-gradient(135deg, #FF8C00 0%, #FFA500 100%);
            color: #101820;
        }
        .btn.secondary:hover { 
            background: linear-gradient(135deg, #2c2416 0%, #101820 100%);
        }
        .btn.danger:hover { 
            background: linear-gradient(135deg, #DC143C 0%, #8B0000 100%);
        }
        .btn.warning:hover { 
            background: linear-gradient(135deg, #FFA500 0%, #FF8C00 100%);
        }

        .main-content {
            display: flex;
            flex: 1;
        }

        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, #f8f6f0 0%, #f0ede0 100%);
            border-right: 3px solid #D3BC8D;
            padding: 20px 0;
        }

        .nav-item {
            display: block;
            padding: 15px 25px;
            color: #101820;
            text-decoration: none;
            border-left: 4px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-item:hover {
            background: linear-gradient(90deg, rgba(211, 188, 141, 0.2) 0%, rgba(211, 188, 141, 0.05) 100%);
            border-left-color: #D3BC8D;
            color: #101820;
        }

        .nav-item.active {
            background: linear-gradient(90deg, rgba(211, 188, 141, 0.3) 0%, rgba(211, 188, 141, 0.1) 100%);
            border-left-color: #D3BC8D;
            color: #101820;
            font-weight: 700;
            box-shadow: inset 0 0 10px rgba(211, 188, 141, 0.2);
        }

        .nav-item .nav-icon {
            margin-right: 12px;
            font-size: 1.3rem;
        }

        .content-area {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background: linear-gradient(180deg, #ffffff 0%, #fdfcf8 100%);
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .page-title {
            font-size: 2rem;
            color: #101820;
            margin-bottom: 30px;
            font-weight: 300;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #ffffff 0%, #fdfcf8 100%);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(16, 24, 32, 0.1);
            border-left: 6px solid #D3BC8D;
            transition: all 0.3s ease;
            border: 1px solid rgba(211, 188, 141, 0.2);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(16, 24, 32, 0.15);
            border-left-color: #f4e4a6;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: #D3BC8D;
            margin-bottom: 5px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .stat-label {
            color: #101820;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .view-options {
            background: linear-gradient(135deg, #ffffff 0%, #fdfcf8 100%);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(16, 24, 32, 0.1);
            margin-bottom: 30px;
            border: 1px solid rgba(211, 188, 141, 0.2);
        }

        .view-options h3 {
            margin-bottom: 20px;
            color: #101820;
            font-weight: 600;
        }

        .filter-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            margin-bottom: 5px;
            color: #101820;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .filter-group select, .filter-group input {
            padding: 12px;
            border: 2px solid #D3BC8D;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            background: #fdfcf8;
        }

        .filter-group select:focus, .filter-group input:focus {
            outline: none;
            border-color: #f4e4a6;
            box-shadow: 0 0 0 3px rgba(211, 188, 141, 0.2);
        }

        .calendar-management {
            background: linear-gradient(135deg, #ffffff 0%, #fdfcf8 100%);
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(16, 24, 32, 0.1);
            overflow: hidden;
            border: 1px solid rgba(211, 188, 141, 0.2);
        }

        .calendar-management-header {
            background: linear-gradient(135deg, #101820 0%, #2c2416 100%);
            color: #D3BC8D;
            padding: 20px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 0;
        }

        .calendar-card {
            padding: 25px;
            border-bottom: 1px solid rgba(211, 188, 141, 0.2);
            border-right: 1px solid rgba(211, 188, 141, 0.2);
            transition: all 0.3s ease;
        }

        .calendar-card:hover {
            background: linear-gradient(135deg, rgba(211, 188, 141, 0.05) 0%, rgba(211, 188, 141, 0.02) 100%);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .calendar-name {
            font-weight: 600;
            font-size: 1.1rem;
            color: #101820;
            margin-bottom: 5px;
        }

        .calendar-id {
            font-size: 0.85rem;
            color: #666;
        }

        .calendar-actions {
            display: flex;
            gap: 8px;
        }

        .calendar-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }

        .calendar-stat {
            text-align: center;
        }

        .calendar-stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: #D3BC8D;
        }

        .calendar-stat-label {
            font-size: 0.75rem;
            color: #101820;
            font-weight: 500;
        }

        .calendar-settings {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 25px;
            background: #ccc;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-switch.active {
            background: #D3BC8D;
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 21px;
            height: 21px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(25px);
        }

        .events-display {
            margin-top: 30px;
        }

        .events-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 20px;
        }

        .calendar-events {
            background: linear-gradient(135deg, #ffffff 0%, #fdfcf8 100%);
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(16, 24, 32, 0.1);
            overflow: hidden;
            border-left: 6px solid #D3BC8D;
            border: 1px solid rgba(211, 188, 141, 0.2);
        }

        .calendar-events-header {
            background: linear-gradient(135deg, #101820 0%, #2c2416 100%);
            color: #D3BC8D;
            padding: 20px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .calendar-title {
            font-weight: 600;
            color: #D3BC8D;
        }

        .event-count {
            background: rgba(211, 188, 141, 0.2);
            color: #D3BC8D;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            border: 1px solid rgba(211, 188, 141, 0.3);
        }

        .events-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .event-item {
            padding: 20px 25px;
            border-bottom: 1px solid rgba(211, 188, 141, 0.1);
            transition: all 0.3s ease;
        }

        .event-item:hover {
            background: linear-gradient(90deg, rgba(211, 188, 141, 0.05) 0%, rgba(211, 188, 141, 0.02) 100%);
        }

        .event-item:last-child {
            border-bottom: none;
        }

        .event-title {
            font-weight: 600;
            color: #101820;
            margin-bottom: 8px;
        }

        .event-time {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .event-location {
            color: #888;
            font-size: 0.85rem;
            font-style: italic;
        }

        /* MONTH VIEW STYLES */
        .month-calendar {
            background: linear-gradient(135deg, #ffffff 0%, #fdfcf8 100%);
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(16, 24, 32, 0.1);
            overflow: hidden;
            border: 1px solid rgba(211, 188, 141, 0.2);
        }

        .month-header {
            background: linear-gradient(135deg, #101820 0%, #2c2416 100%);
            color: #D3BC8D;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .month-nav {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .month-nav button {
            background: rgba(211, 188, 141, 0.2);
            color: #D3BC8D;
            border: 1px solid rgba(211, 188, 141, 0.3);
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .month-nav button:hover {
            background: rgba(211, 188, 141, 0.3);
            transform: scale(1.05);
        }

        .month-title {
            font-size: 1.8rem;
            font-weight: 700;
            text-align: center;
            min-width: 200px;
        }

        .calendar-grid-month {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0;
        }

        .day-header {
            background: linear-gradient(135deg, #D3BC8D 0%, #f4e4a6 100%);
            color: #101820;
            padding: 15px 8px;
            text-align: center;
            font-weight: 700;
            font-size: 0.9rem;
            border-right: 1px solid rgba(16, 24, 32, 0.1);
        }

        .day-header:last-child {
            border-right: none;
        }

        .day-cell {
            min-height: 120px;
            border-right: 1px solid rgba(211, 188, 141, 0.2);
            border-bottom: 1px solid rgba(211, 188, 141, 0.2);
            padding: 8px;
            position: relative;
            transition: all 0.3s ease;
        }

        .day-cell:hover {
            background: linear-gradient(135deg, rgba(211, 188, 141, 0.05) 0%, rgba(211, 188, 141, 0.02) 100%);
        }

        .day-cell:last-child {
            border-right: none;
        }

        .day-number {
            font-weight: 600;
            color: #101820;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .day-cell.other-month .day-number {
            color: #ccc;
        }

        .day-cell.today {
            background: linear-gradient(135deg, rgba(211, 188, 141, 0.2) 0%, rgba(211, 188, 141, 0.1) 100%);
        }

        .day-cell.today .day-number {
            background: #D3BC8D;
            color: #101820;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.8rem;
        }

        .day-events {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .day-event {
            background: #D3BC8D;
            color: #101820;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.7rem;
            font-weight: 600;
            text-overflow: ellipsis;
            overflow: hidden;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .day-event:hover {
            background: #f4e4a6;
            transform: scale(1.02);
        }

        .more-events {
            color: #101820;
            font-size: 0.65rem;
            font-weight: 600;
            text-align: center;
            cursor: pointer;
            padding: 2px;
        }

        .more-events:hover {
            text-decoration: underline;
        }

        .loading {
            text-align: center;
            padding: 60px;
            color: #101820;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(211, 188, 141, 0.3);
            border-top: 5px solid #D3BC8D;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .auth-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 80vh;
            text-align: center;
            padding: 40px;
            background: linear-gradient(135deg, rgba(211, 188, 141, 0.05) 0%, rgba(211, 188, 141, 0.02) 100%);
        }

        .auth-screen h2 {
            margin-bottom: 20px;
            color: #101820;
            font-weight: 300;
        }

        .auth-screen p {
            margin-bottom: 30px;
            color: #666;
            line-height: 1.6;
        }

        .success {
            background: linear-gradient(135deg, #d4edda 0%, #c8e6c9 100%);
            color: #155724;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #28a745;
            box-shadow: 0 3px 10px rgba(40, 167, 69, 0.2);
        }

        .error {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #dc3545;
            box-shadow: 0 3px 10px rgba(220, 53, 69, 0.2);
        }

        @media (max-width: 1024px) {
            .main-content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 3px solid #D3BC8D;
            }
            
            .sidebar .nav-item {
                display: inline-block;
                margin: 0 10px;
            }
        }

        @media (max-width: 768px) {
            .filter-controls {
                grid-template-columns: 1fr;
            }
            
            .events-container {
                grid-template-columns: 1fr;
            }
            
            .calendar-grid {
                grid-template-columns: 1fr;
            }

            .day-cell {
                min-height: 80px;
            }

            .day-event {
                font-size: 0.65rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                <span class="saints-logo">⚜️</span>
                Saints Calendar Dashboard
            </h1>
            <div class="header-controls">
                <div id="user-info" class="user-info" style="display: none;">
                    👤 <span id="user-email"></span>
                </div>
                <button id="sign-in-btn" class="btn" onclick="signIn()">
                    🔐 Sign In
                </button>
                <button id="sign-out-btn" class="btn danger" onclick="signOut()" style="display: none;">
                    🚪 Sign Out
                </button>
            </div>
        </div>

        <div id="auth-screen" class="auth-screen">
            <h2>⚜️ Welcome to your Saints Calendar Dashboard</h2>
            <p>Sign in with your Google account to access your calendars with championship-level organization!</p>
            <button class="btn" onclick="signIn()" style="font-size: 1.1rem; padding: 15px 30px;">
                🔐 Get Started - Sign In with Google
            </button>
        </div>

        <div id="main-app" class="main-content" style="display: none;">
            <div class="sidebar">
                <a href="#" class="nav-item active" onclick="showPage('dashboard')">
                    <span class="nav-icon">📊</span>Dashboard
                </a>
                <a href="#" class="nav-item" onclick="showPage('month')">
                    <span class="nav-icon">🗓️</span>Month View
                </a>
                <a href="#" class="nav-item" onclick="showPage('calendars')">
                    <span class="nav-icon">📅</span>Calendar Management
                </a>
                <a href="#" class="nav-item" onclick="showPage('agenda')">
                    <span class="nav-icon">📋</span>Agenda View
                </a>
                <a href="#" class="nav-item" onclick="showPage('timeline')">
                    <span class="nav-icon">⏰</span>Timeline View
                </a>
                <a href="#" class="nav-item" onclick="showPage('analytics')">
                    <span class="nav-icon">📈</span>Analytics
                </a>
                <a href="#" class="nav-item" onclick="showPage('settings')">
                    <span class="nav-icon">⚙️</span>Settings
                </a>
            </div>

            <div class="content-area">
                <!-- Dashboard Page -->
                <div id="dashboard-page" class="page active">
                    <h2 class="page-title">⚜️ Dashboard Overview</h2>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="total-calendars">0</div>
                            <div class="stat-label">Active Calendars</div>
                        </div>
                        <div class="stat-card" style="border-left-color: #101820;">
                            <div class="stat-number" style="color: #101820;" id="total-events">0</div>
                            <div class="stat-label">Upcoming Events</div>
                        </div>
                        <div class="stat-card" style="border-left-color: #8B0000;">
                            <div class="stat-number" style="color: #8B0000;" id="today-events">0</div>
                            <div class="stat-label">Events Today</div>
                        </div>
                        <div class="stat-card" style="border-left-color: #FF8C00;">
                            <div class="stat-number" style="color: #FF8C00;" id="week-events">0</div>
                            <div class="stat-label">This Week</div>
                        </div>
                    </div>

                    <div class="view-options">
                        <h3>🏈 Quick View Options</h3>
                        <div class="filter-controls">
                            <div class="filter-group">
                                <label>Time Range</label>
                                <select id="time-range" onchange="applyFilters()">
                                    <option value="today">Today</option>
                                    <option value="tomorrow">Tomorrow</option>
                                    <option value="week" selected>This Week</option>
                                    <option value="month">This Month</option>
                                    <option value="custom">Custom Range</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Show Events From</label>
                                <select id="calendar-filter" onchange="applyFilters()">
                                    <option value="all">All Calendars</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Event Type</label>
                                <select id="event-type" onchange="applyFilters()">
                                    <option value="all">All Events</option>
                                    <option value="busy">Busy Events Only</option>
                                    <option value="free">Free/Available</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Sort By</label>
                                <select id="sort-by" onchange="applyFilters()">
                                    <option value="time">Start Time</option>
                                    <option value="calendar">Calendar</option>
                                    <option value="title">Event Title</option>
                                </select>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="btn" onclick="applyFilters()">🔍 Apply Filters</button>
                            <button class="btn secondary" onclick="refreshAllData()">🔄 Refresh Data</button>
                            <button class="btn warning" onclick="exportEvents()">📊 Export Events</button>
                        </div>
                    </div>

                    <div id="dashboard-events" class="events-display">
                        <div class="events-container" id="dashboard-events-container"></div>
                    </div>
                </div>

                <!-- Month View Page -->
                <div id="month-page" class="page">
                    <h2 class="page-title">🗓️ Month View</h2>
                    
                    <div class="month-calendar">
                        <div class="month-header">
                            <div class="month-nav">
                                <button onclick="previousMonth()">← Previous</button>
                            </div>
                            <div class="month-title" id="month-title"></div>
                            <div class="month-nav">
                                <button onclick="nextMonth()">Next →</button>
                                <button onclick="goToToday()" style="margin-left: 15px;">Today</button>
                                <span class="last-updated" style="margin-left: 15px; font-size: 0.8rem;">Never updated</span>
                            </div>
                        </div>
                        <div class="calendar-grid-month">
                            <div class="day-header">Sunday</div>
                            <div class="day-header">Monday</div>
                            <div class="day-header">Tuesday</div>
                            <div class="day-header">Wednesday</div>
                            <div class="day-header">Thursday</div>
                            <div class="day-header">Friday</div>
                            <div class="day-header">Saturday</div>
                            <!-- Calendar days will be inserted here -->
                        </div>
                    </div>
                </div>

                <!-- Calendar Management Page -->
                <div id="calendars-page" class="page">
                    <h2 class="page-title">📅 Calendar Management</h2>
                    
                    <div class="calendar-management">
                        <div class="calendar-management-header">
                            <h3>Your Calendars</h3>
                            <div style="display: flex; gap: 10px;">
                                <button class="btn secondary" onclick="addMyCalendars()">📋 Import My Calendars</button>
                                <button class="btn" onclick="showAddCalendarForm()">➕ Add Calendar</button>
                            </div>
                        </div>
                        <div class="calendar-grid" id="calendar-grid"></div>
                    </div>
                </div>

                <!-- Agenda View Page -->
                <div id="agenda-page" class="page">
                    <h2 class="page-title">📋 Agenda View</h2>
                    <div id="agenda-content"></div>
                </div>

                <!-- Timeline View Page -->
                <div id="timeline-page" class="page">
                    <h2 class="page-title">⏰ Timeline View</h2>
                    <div id="timeline-content"></div>
                </div>

                <!-- Analytics Page -->
                <div id="analytics-page" class="page">
                    <h2 class="page-title">📈 Calendar Analytics</h2>
                    <div id="analytics-content"></div>
                </div>

                <!-- Settings Page -->
                <div id="settings-page" class="page">
                    <h2 class="page-title">⚙️ Settings</h2>
                    <div id="settings-content">
                        <div class="view-options">
                            <h3>⚙️ Display Settings</h3>
                            <div class="filter-controls">
                                <div class="filter-group">
                                    <label>Default Time Range</label>
                                    <select id="default-range">
                                        <option value="week" selected>This Week</option>
                                        <option value="month">This Month</option>
                                        <option value="today">Today Only</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label>Events Per Calendar</label>
                                    <select id="events-limit">
                                        <option value="5">5 Events</option>
                                        <option value="10" selected>10 Events</option>
                                        <option value="20">20 Events</option>
                                        <option value="50">50 Events</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="loading" class="loading" style="display: none;">
            <div class="spinner"></div>
            <p>Loading your championship calendar data...</p>
        </div>
    </div>

    <script async defer src="https://apis.google.com/js/api.js" onload="handleGapiLoad()"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="handleGsiLoad()"></script>

    <script>
        // Configuration - Replace with your own Google API credentials
        const CLIENT_ID = '850403111308-r3j8hku5lb9efkg2r1ajte7mu6hlf76b.apps.googleusercontent.com';
        const API_KEY = 'AIzaSyCeibmX-PQqFBbADI6m80Xce_WL42QIEks';
        const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest';
        const SCOPES = 'https://www.googleapis.com/auth/calendar.readonly';

        let tokenClient;
        let gapiInited = false;
        let gsiInited = false;
        let isSignedIn = false;
        let calendars = [];
        let allEvents = [];
        let currentUser = null;
        let currentDate = new Date();

        // Initialize APIs
        async function handleGapiLoad() {
            await new Promise((resolve) => {
                gapi.load('client', resolve);
            });
            await gapi.client.init({
                apiKey: API_KEY,
                discoveryDocs: [DISCOVERY_DOC],
            });
            gapiInited = true;
            maybeEnableButtons();
        }

        function handleGsiLoad() {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: SCOPES,
                callback: handleAuthCallback,
            });
            gsiInited = true;
            maybeEnableButtons();
        }

        function handleAuthCallback(response) {
            if (response.error) {
                showError('Authentication failed: ' + response.error);
                return;
            }
            onSignIn();
        }

        function maybeEnableButtons() {
            if (gapiInited && gsiInited) {
                document.getElementById('sign-in-btn').disabled = false;
            }
        }

        function signIn() {
            if (!gapiInited || !gsiInited) {
                showError('Google APIs are still loading. Please try again.');
                return;
            }
            tokenClient.requestAccessToken();
        }

        function signOut() {
            const token = gapi.client.getToken();
            if (token) {
                google.accounts.oauth2.revoke(token.access_token);
                gapi.client.setToken('');
            }
            onSignOut();
        }

        async function onSignIn() {
            isSignedIn = true;
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('main-app').style.display = 'flex';
            document.getElementById('sign-in-btn').style.display = 'none';
            document.getElementById('sign-out-btn').style.display = 'inline-flex';
            document.getElementById('user-info').style.display = 'block';
            
            // Get user info
            try {
                const userInfo = await gapi.client.request({
                    path: 'https://www.googleapis.com/oauth2/v2/userinfo'
                });
                currentUser = userInfo.result;
                document.getElementById('user-email').textContent = currentUser.email;
            } catch (error) {
                console.error('Failed to get user info:', error);
            }

            // Auto-load user calendars
            await addMyCalendars();
            showSuccess('⚜️ Welcome to your Saints Calendar! Your calendars are loading...');
        }

        function onSignOut() {
            isSignedIn = false;
            calendars = [];
            allEvents = [];
            document.getElementById('auth-screen').style.display = 'flex';
            document.getElementById('main-app').style.display = 'none';
            document.getElementById('sign-in-btn').style.display = 'inline-flex';
            document.getElementById('sign-out-btn').style.display = 'none';
            document.getElementById('user-info').style.display = 'none';
        }

        // Navigation
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId + '-page').classList.add('active');
            
            // Add active class to clicked nav item
            event.target.classList.add('active');

            // Load page-specific data
            switch(pageId) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'month':
                    loadMonthView();
                    break;
                case 'calendars':
                    loadCalendarManagement();
                    break;
                case 'agenda':
                    loadAgendaView();
                    break;
                case 'timeline':
                    loadTimelineView();
                    break;
                case 'analytics':
                    loadAnalytics();
                    break;
            }
        }

        // Calendar Management
        async function addMyCalendars() {
            if (!isSignedIn) return;

            showLoading(true);
            try {
                const response = await gapi.client.calendar.calendarList.list();
                const calendarList = response.result.items;

                calendars = []; // Reset calendars
                for (const cal of calendarList) {
                    calendars.push({
                        id: cal.id,
                        name: cal.summary,
                        color: cal.backgroundColor || '#D3BC8D',
                        enabled: true,
                        primary: cal.primary || false
                    });
                }

                updateCalendarFilter();
                await refreshAllData();
                loadCalendarManagement();
                showSuccess(`⚜️ Added ${calendarList.length} calendars from your account.`);
            } catch (error) {
                showError('Failed to load your calendars: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        function updateCalendarFilter() {
            const select = document.getElementById('calendar-filter');
            select.innerHTML = '<option value="all">All Calendars</option>';
            
            calendars.forEach(calendar => {
                const option = document.createElement('option');
                option.value = calendar.id;
                option.textContent = calendar.name;
                select.appendChild(option);
            });
        }

        async function refreshAllData() {
            if (calendars.length === 0) return;

            showLoading(true);
            allEvents = [];

            const now = new Date();
            const timeMin = new Date(now.getFullYear(), now.getMonth() - 1, 1).toISOString();
            const timeMax = new Date(now.getFullYear(), now.getMonth() + 2, 0).toISOString();

            for (const calendar of calendars.filter(c => c.enabled)) {
                try {
                    const response = await gapi.client.calendar.events.list({
                        calendarId: calendar.id,
                        timeMin: timeMin,
                        timeMax: timeMax,
                        showDeleted: false,
                        singleEvents: true,
                        maxResults: 100,
                        orderBy: 'startTime'
                    });

                    const events = response.result.items || [];
                    events.forEach(event => {
                        allEvents.push({
                            ...event,
                            calendarId: calendar.id,
                            calendarName: calendar.name,
                            calendarColor: calendar.color
                        });
                    });
                } catch (error) {
                    console.error(`Error loading events for ${calendar.name}:`, error);
                }
            }

            updateStats();
            showLoading(false);
        }

        function updateStats() {
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const weekEnd = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);

            const todayEvents = allEvents.filter(event => {
                const eventDate = new Date(event.start.dateTime || event.start.date);
                return eventDate >= today && eventDate < new Date(today.getTime() + 24 * 60 * 60 * 1000);
            });

            const weekEvents = allEvents.filter(event => {
                const eventDate = new Date(event.start.dateTime || event.start.date);
                return eventDate >= today && eventDate <= weekEnd;
            });

            document.getElementById('total-calendars').textContent = calendars.filter(c => c.enabled).length;
            document.getElementById('total-events').textContent = allEvents.length;
            document.getElementById('today-events').textContent = todayEvents.length;
            document.getElementById('week-events').textContent = weekEvents.length;
        }

        // Month View Functions
        function loadMonthView() {
            renderMonthCalendar();
        }

        function renderMonthCalendar() {
            const monthTitle = document.getElementById('month-title');
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];
            
            monthTitle.textContent = `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;

            const calendarGrid = document.querySelector('.calendar-grid-month');
            
            // Remove existing day cells
            const existingDays = calendarGrid.querySelectorAll('.day-cell');
            existingDays.forEach(day => day.remove());

            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            const today = new Date();
            const isCurrentMonth = today.getMonth() === currentDate.getMonth() && today.getFullYear() === currentDate.getFullYear();

            for (let i = 0; i < 42; i++) { // 6 weeks × 7 days
                const cellDate = new Date(startDate);
                cellDate.setDate(startDate.getDate() + i);
                
                const dayCell = document.createElement('div');
                dayCell.className = 'day-cell';
                
                if (cellDate.getMonth() !== currentDate.getMonth()) {
                    dayCell.classList.add('other-month');
                }
                
                if (isCurrentMonth && cellDate.toDateString() === today.toDateString()) {
                    dayCell.classList.add('today');
                }

                dayCell.innerHTML = `
                    <div class="day-number">${cellDate.getDate()}</div>
                    <div class="day-events" id="day-${cellDate.getTime()}"></div>
                `;

                calendarGrid.appendChild(dayCell);
                
                // Add events for this day
                renderDayEvents(cellDate);
            }
        }

        function renderDayEvents(date) {
            const dayEventsContainer = document.getElementById(`day-${date.getTime()}`);
            const dayStart = new Date(date.getFullYear(), date.getMonth(), date.getDate());
            const dayEnd = new Date(dayStart.getTime() + 24 * 60 * 60 * 1000);

            const dayEvents = allEvents.filter(event => {
                const eventStart = new Date(event.start.dateTime || event.start.date);
                const eventEnd = new Date(event.end.dateTime || event.end.date);
                
                // Check if event overlaps with this day
                return (eventStart < dayEnd && eventEnd > dayStart);
            }).sort((a, b) => {
                const aTime = new Date(a.start.dateTime || a.start.date);
                const bTime = new Date(b.start.dateTime || b.start.date);
                return aTime - bTime;
            });

            dayEventsContainer.innerHTML = '';

            const maxVisible = 3;
            const visibleEvents = dayEvents.slice(0, maxVisible);
            const hiddenCount = dayEvents.length - maxVisible;

            visibleEvents.forEach(event => {
                const eventDiv = document.createElement('div');
                eventDiv.className = 'day-event';
                eventDiv.style.backgroundColor = event.calendarColor;
                eventDiv.textContent = event.summary || 'No title';
                eventDiv.title = `${event.summary || 'No title'} (${event.calendarName})`;
                
                dayEventsContainer.appendChild(eventDiv);
            });

            if (hiddenCount > 0) {
                const moreDiv = document.createElement('div');
                moreDiv.className = 'more-events';
                moreDiv.textContent = `+${hiddenCount} more`;
                moreDiv.onclick = () => showDayEvents(date, dayEvents);
                dayEventsContainer.appendChild(moreDiv);
            }
        }

        function showDayEvents(date, events) {
            const dateStr = date.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            let eventsList = events.map(event => {
                const time = event.start.dateTime ? 
                    new Date(event.start.dateTime).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) :
                    'All day';
                return `<div style="padding: 10px; border-left: 4px solid ${event.calendarColor}; margin: 5px 0; background: #f9f9f9;">
                    <strong>${event.summary || 'No title'}</strong><br>
                    <small>${time} - ${event.calendarName}</small>
                    ${event.location ? `<br><small>📍 ${event.location}</small>` : ''}
                </div>`;
            }).join('');

            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                background: rgba(0,0,0,0.5); z-index: 1000;
                display: flex; align-items: center; justify-content: center;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 15px; max-width: 500px; max-height: 80vh; overflow-y: auto;">
                    <h3 style="margin-bottom: 20px; color: #101820;">${dateStr}</h3>
                    ${events.length > 0 ? eventsList : '<p style="color: #666;">No events scheduled</p>'}
                    <button onclick="this.closest('.modal').remove()" style="margin-top: 20px; padding: 10px 20px; background: #D3BC8D; border: none; border-radius: 8px; cursor: pointer;">Close</button>
                </div>
            `;
            modal.className = 'modal';
            modal.onclick = (e) => {
                if (e.target === modal) modal.remove();
            };

            document.body.appendChild(modal);
        }

        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderMonthCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderMonthCalendar();
        }

        function goToToday() {
            currentDate = new Date();
            renderMonthCalendar();
        }

        // Dashboard
        function loadDashboard() {
            applyFilters();
        }

        function applyFilters() {
            const timeRange = document.getElementById('time-range').value;
            const calendarFilter = document.getElementById('calendar-filter').value;
            const eventType = document.getElementById('event-type').value;
            const sortBy = document.getElementById('sort-by').value;

            let filteredEvents = [...allEvents];

            // Apply time filter
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());

            switch(timeRange) {
                case 'today':
                    filteredEvents = filteredEvents.filter(event => {
                        const eventDate = new Date(event.start.dateTime || event.start.date);
                        return eventDate >= today && eventDate < new Date(today.getTime() + 24 * 60 * 60 * 1000);
                    });
                    break;
                case 'tomorrow':
                    const tomorrow = new Date(today.getTime() + 24 * 60 * 60 * 1000);
                    filteredEvents = filteredEvents.filter(event => {
                        const eventDate = new Date(event.start.dateTime || event.start.date);
                        return eventDate >= tomorrow && eventDate < new Date(tomorrow.getTime() + 24 * 60 * 60 * 1000);
                    });
                    break;
                case 'week':
                    const weekEnd = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
                    filteredEvents = filteredEvents.filter(event => {
                        const eventDate = new Date(event.start.dateTime || event.start.date);
                        return eventDate >= today && eventDate <= weekEnd;
                    });
                    break;
                case 'month':
                    const monthEnd = new Date(today.getFullYear(), today.getMonth() + 1, today.getDate());
                    filteredEvents = filteredEvents.filter(event => {
                        const eventDate = new Date(event.start.dateTime || event.start.date);
                        return eventDate >= today && eventDate <= monthEnd;
                    });
                    break;
            }

            // Apply calendar filter
            if (calendarFilter !== 'all') {
                filteredEvents = filteredEvents.filter(event => event.calendarId === calendarFilter);
            }

            // Apply sorting
            filteredEvents.sort((a, b) => {
                switch(sortBy) {
                    case 'time':
                        return new Date(a.start.dateTime || a.start.date) - new Date(b.start.dateTime || b.start.date);
                    case 'calendar':
                        return a.calendarName.localeCompare(b.calendarName);
                    case 'title':
                        return (a.summary || '').localeCompare(b.summary || '');
                    default:
                        return 0;
                }
            });

            displayFilteredEvents(filteredEvents);
        }

        function displayFilteredEvents(events) {
            const container = document.getElementById('dashboard-events-container');
            container.innerHTML = '';

            if (events.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; grid-column: 1 / -1; padding: 40px;">No events found for the selected criteria.</p>';
                return;
            }

            // Group events by calendar
            const eventsByCalendar = {};
            events.forEach(event => {
                if (!eventsByCalendar[event.calendarId]) {
                    eventsByCalendar[event.calendarId] = {
                        calendar: calendars.find(c => c.id === event.calendarId),
                        events: []
                    };
                }
                eventsByCalendar[event.calendarId].events.push(event);
            });

            // Create calendar event containers
            Object.values(eventsByCalendar).forEach(({calendar, events}) => {
                const calendarDiv = document.createElement('div');
                calendarDiv.className = 'calendar-events';
                calendarDiv.style.borderLeftColor = calendar.color;

                calendarDiv.innerHTML = `
                    <div class="calendar-events-header">
                        <div class="calendar-title">${escapeHtml(calendar.name)}</div>
                        <div class="event-count">${events.length}</div>
                    </div>
                    <div class="events-list">
                        ${events.map(event => `
                            <div class="event-item">
                                <div class="event-title">${escapeHtml(event.summary || 'No title')}</div>
                                <div class="event-time">${formatEventTime(event)}</div>
                                ${event.location ? `<div class="event-location">📍 ${escapeHtml(event.location)}</div>` : ''}
                            </div>
                        `).join('')}
                    </div>
                `;

                container.appendChild(calendarDiv);
            });
        }

        // Calendar Management Page
        function loadCalendarManagement() {
            const container = document.getElementById('calendar-grid');
            container.innerHTML = '';

            calendars.forEach(calendar => {
                const div = document.createElement('div');
                div.className = 'calendar-card';
                
                const calendarEvents = allEvents.filter(e => e.calendarId === calendar.id);
                const todayEvents = calendarEvents.filter(event => {
                    const now = new Date();
                    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                    const eventDate = new Date(event.start.dateTime || event.start.date);
                    return eventDate >= today && eventDate < new Date(today.getTime() + 24 * 60 * 60 * 1000);
                });

                div.innerHTML = `
                    <div class="calendar-header">
                        <div>
                            <div class="calendar-name">${escapeHtml(calendar.name)}</div>
                            <div class="calendar-id">${escapeHtml(calendar.id)}</div>
                        </div>
                        <div class="calendar-actions">
                            <button class="btn" style="padding: 5px 10px; font-size: 0.8rem;" onclick="removeCalendar('${calendar.id}')">Remove</button>
                        </div>
                    </div>
                    <div class="calendar-stats">
                        <div class="calendar-stat">
                            <div class="calendar-stat-number">${calendarEvents.length}</div>
                            <div class="calendar-stat-label">Total Events</div>
                        </div>
                        <div class="calendar-stat">
                            <div class="calendar-stat-number">${todayEvents.length}</div>
                            <div class="calendar-stat-label">Today</div>
                        </div>
                    </div>
                    <div class="calendar-settings">
                        <span style="font-size: 0.9rem; color: #666;">Enabled:</span>
                        <div class="toggle-switch ${calendar.enabled ? 'active' : ''}" onclick="toggleCalendar('${calendar.id}')">
                            <div class="toggle-slider"></div>
                        </div>
                        <div style="width: 20px; height: 20px; background: ${calendar.color}; border-radius: 50%; margin-left: 10px;"></div>
                    </div>
                `;

                container.appendChild(div);
            });
        }

        function toggleCalendar(calendarId) {
            const calendar = calendars.find(c => c.id === calendarId);
            if (calendar) {
                calendar.enabled = !calendar.enabled;
                loadCalendarManagement();
                refreshAllData();
                // Update month view if it's currently active
                if (document.getElementById('month-page').classList.contains('active')) {
                    renderMonthCalendar();
                }
            }
        }

        function removeCalendar(calendarId) {
            if (confirm('Are you sure you want to remove this calendar?')) {
                calendars = calendars.filter(c => c.id !== calendarId);
                allEvents = allEvents.filter(e => e.calendarId !== calendarId);
                updateCalendarFilter();
                updateStats();
                loadCalendarManagement();
                // Update month view if it's currently active
                if (document.getElementById('month-page').classList.contains('active')) {
                    renderMonthCalendar();
                }
                showSuccess('⚜️ Calendar removed successfully.');
            }
        }

        // Agenda View
        function loadAgendaView() {
            const container = document.getElementById('agenda-content');
            
            // Group events by date
            const eventsByDate = {};
            const sortedEvents = [...allEvents].sort((a, b) => 
                new Date(a.start.dateTime || a.start.date) - new Date(b.start.dateTime || b.start.date)
            );

            sortedEvents.forEach(event => {
                const date = new Date(event.start.dateTime || event.start.date);
                const dateKey = date.toDateString();
                
                if (!eventsByDate[dateKey]) {
                    eventsByDate[dateKey] = [];
                }
                eventsByDate[dateKey].push(event);
            });

            let html = '<div class="view-options"><h3>🏈 Agenda View</h3><p>All your events organized by date in championship style</p></div>';
            
            Object.keys(eventsByDate).forEach(dateKey => {
                const events = eventsByDate[dateKey];
                const date = new Date(dateKey);
                
                html += `
                    <div class="calendar-events" style="margin-bottom: 20px;">
                        <div class="calendar-events-header">
                            <div class="calendar-title">${date.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</div>
                            <div class="event-count">${events.length}</div>
                        </div>
                        <div class="events-list">
                            ${events.map(event => `
                                <div class="event-item">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                        <div style="flex: 1;">
                                            <div class="event-title">${escapeHtml(event.summary || 'No title')}</div>
                                            <div class="event-time">${formatEventTime(event)}</div>
                                            ${event.location ? `<div class="event-location">📍 ${escapeHtml(event.location)}</div>` : ''}
                                        </div>
                                        <div style="background: ${event.calendarColor}; color: #101820; padding: 4px 8px; border-radius: 12px; font-size: 0.7rem; white-space: nowrap; font-weight: 600;">
                                            ${escapeHtml(event.calendarName)}
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Timeline View
        function loadTimelineView() {
            const container = document.getElementById('timeline-content');
            
            const now = new Date();
            const todayEvents = allEvents.filter(event => {
                const eventDate = new Date(event.start.dateTime || event.start.date);
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                return eventDate >= today && eventDate < new Date(today.getTime() + 24 * 60 * 60 * 1000);
            }).sort((a, b) => 
                new Date(a.start.dateTime || a.start.date) - new Date(b.start.dateTime || b.start.date)
            );

            let html = '<div class="view-options"><h3>⚜️ Today\'s Timeline</h3><p>Your championship schedule for today in winning order</p></div>';
            
            if (todayEvents.length === 0) {
                html += '<div class="calendar-events"><div class="events-list"><div class="event-item" style="text-align: center; color: #666;">No events scheduled for today - time to celebrate! ⚜️</div></div></div>';
            } else {
                html += '<div class="calendar-events"><div class="events-list">';
                
                todayEvents.forEach((event, index) => {
                    const eventTime = new Date(event.start.dateTime || event.start.date);
                    const isNow = now >= eventTime && now <= new Date(event.end.dateTime || event.end.date);
                    
                    html += `
                        <div class="event-item" style="${isNow ? 'background: linear-gradient(90deg, rgba(211, 188, 141, 0.2) 0%, rgba(211, 188, 141, 0.1) 100%); border-left: 4px solid #D3BC8D;' : ''}">
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <div style="min-width: 80px; text-align: center; font-weight: 600; color: ${isNow ? '#D3BC8D' : '#666'};">
                                    ${event.start.dateTime ? eventTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : 'All Day'}
                                    ${isNow ? '<div style="font-size: 0.7rem; color: #D3BC8D;">⚜️ NOW</div>' : ''}
                                </div>
                                <div style="flex: 1;">
                                    <div class="event-title">${escapeHtml(event.summary || 'No title')}</div>
                                    <div style="font-size: 0.8rem; color: ${event.calendarColor};">📅 ${escapeHtml(event.calendarName)}</div>
                                    ${event.location ? `<div class="event-location">📍 ${escapeHtml(event.location)}</div>` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div></div>';
            }

            container.innerHTML = html;
        }

        // Analytics
        function loadAnalytics() {
            const container = document.getElementById('analytics-content');
            
            // Calculate analytics
            const calendarStats = calendars.map(calendar => {
                const calendarEvents = allEvents.filter(e => e.calendarId === calendar.id);
                return {
                    name: calendar.name,
                    color: calendar.color,
                    eventCount: calendarEvents.length
                };
            }).sort((a, b) => b.eventCount - a.eventCount);

            const totalEvents = allEvents.length;
            
            let html = `
                <div class="view-options">
                    <h3>⚜️ Calendar Analytics</h3>
                    <p>Championship-level insights about your calendar performance</p>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">${totalEvents}</div>
                        <div class="stat-label">Total Events (Next 90 Days)</div>
                    </div>
                    <div class="stat-card" style="border-left-color: #101820;">
                        <div class="stat-number" style="color: #101820;">${calendars.length}</div>
                        <div class="stat-label">Active Calendars</div>
                    </div>
                    <div class="stat-card" style="border-left-color: #8B0000;">
                        <div class="stat-number" style="color: #8B0000;">${(totalEvents / 30).toFixed(1)}</div>
                        <div class="stat-label">Events per Day (Avg)</div>
                    </div>
                    <div class="stat-card" style="border-left-color: #FF8C00;">
                        <div class="stat-number" style="color: #FF8C00;">${calendarStats[0]?.name.substring(0, 10) + '...' || 'N/A'}</div>
                        <div class="stat-label">Most Active Calendar</div>
                    </div>
                </div>

                <div class="calendar-management">
                    <div class="calendar-management-header">
                        <h3>Events by Calendar</h3>
                    </div>
                    <div class="events-list">
            `;

            calendarStats.forEach(stat => {
                const percentage = totalEvents > 0 ? Math.round((stat.eventCount / totalEvents) * 100) : 0;
                html += `
                    <div class="event-item">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <div style="width: 20px; height: 20px; background: ${stat.color}; border-radius: 50%;"></div>
                                <div>
                                    <div class="event-title">${escapeHtml(stat.name)}</div>
                                    <div style="font-size: 0.9rem; color: #666;">${stat.eventCount} events (${percentage}%)</div>
                                </div>
                            </div>
                            <div style="background: #f0f0f0; width: 200px; height: 8px; border-radius: 4px; overflow: hidden;">
                                <div style="background: ${stat.color}; height: 100%; width: ${percentage}%; border-radius: 4px;"></div>
                            </div>
                        </div>
                    </div>
                `;
            });

            html += '</div></div>';
            container.innerHTML = html;
        }

        // Utility functions
        function formatEventTime(event) {
            const start = event.start.dateTime ? new Date(event.start.dateTime) : new Date(event.start.date);
            const end = event.end.dateTime ? new Date(event.end.dateTime) : new Date(event.end.date);
            
            if (event.start.date) {
                return start.toLocaleDateString();
            } else {
                return `${start.toLocaleDateString()} ${start.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})} - ${end.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
            }
        }

        function exportEvents() {
            const csvContent = "data:text/csv;charset=utf-8," 
                + "Title,Calendar,Start,End,Location\n"
                + allEvents.map(event => {
                    const start = event.start.dateTime || event.start.date;
                    const end = event.end.dateTime || event.end.date;
                    return `"${event.summary || 'No title'}","${event.calendarName}","${start}","${end}","${event.location || ''}"`;
                }).join("\n");

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "saints_calendar_events.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showSuccess('⚜️ Events exported to CSV file with championship style!');
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'flex' : 'none';
        }

        function showError(message) {
            removeMessages();
            const error = document.createElement('div');
            error.className = 'error';
            error.textContent = message;
            document.body.appendChild(error);
            setTimeout(removeMessages, 5000);
        }

        function showSuccess(message) {
            removeMessages();
            const success = document.createElement('div');
            success.className = 'success';
            success.textContent = message;
            document.body.appendChild(success);
            setTimeout(removeMessages, 3000);
        }

        function removeMessages() {
            const messages = document.querySelectorAll('.error, .success');
            messages.forEach(msg => msg.remove());
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Set default time range to week
            document.getElementById('time-range').value = 'week';
        });
    </script>
</body>
</html>
